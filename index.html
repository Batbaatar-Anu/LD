<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Demo</title>

<style>
  html,body{margin:0;height:100%;background:#000}
  #unity-canvas{width:100vw;height:100vh;display:block}
  #overlay{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:none;z-index:4}
  #gate{position:fixed;inset:0;display:grid;place-items:center;background:#000;color:#fff;z-index:5}
  button{padding:14px 22px;border-radius:12px;border:0;font-size:16px}
</style>
</head><body>
  <canvas id="unity-canvas" tabindex="-1"></canvas>
  <video id="overlay" playsinline muted loop></video>
  <div id="gate"><button id="startBtn">Start</button></div>

<script>
  // --- Video source (MOV/WebM) ---
  const v = document.getElementById('overlay');
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

  // Таны өгсөн URL:
  const MOV_URL  = "https://archive.org/download/intro1_202508/intro1.mov";
  const WEBM_URL = null; // Хэрэв webm+alpha байгаа бол "https://..." гэж өг

  v.src = (!isSafari && WEBM_URL) ? WEBM_URL : MOV_URL;
  v.onerror = () => console.error('Video error', v.error);

  // --- Unity-г ачаалаад instance-аа хадгална ---
  let unityInstance;
  createUnityInstance(document.querySelector("#unity-canvas"), {
    dataUrl:"", frameworkUrl:"", codeUrl:"",
    memoryUrl:"", symbolsUrl:"",
    companyName:"DefaultCompany", productName:"Demo", productVersion:"0.1"
  }).then(u => { unityInstance = u; }).catch(err => console.error(err));

  // --- НЭГ Л START товч: видео + AR зэрэг асаана ---
  document.getElementById('startBtn').onclick = async () => {
    document.getElementById('gate').style.display = 'none';
    try {
      v.style.display = 'block';
      v.currentTime = 0;
      await v.play(); // iOS autoplay-д хэрэглэгчийн gesture зайлшгүй
    } catch(e){ console.warn(e); }

    // Unity доторх ARManager → StartAR() дуудах
    const callStart = () => unityInstance && unityInstance.SendMessage('ARManager','StartAR');
    if (!callStart()) {
      const iv = setInterval(() => { if (unityInstance) { callStart(); clearInterval(iv); } }, 200);
    }
  };

  // --- C#-аас дуудах гүүр (overlay.jslib) ---
  window.Overlay = {
    show: s => v.style.display = s ? 'block' : 'none',
    play: () => { try { v.currentTime = 0; v.play(); } catch(e){} },
    pause: () => v.pause()
  };
</script>
</body></html>
