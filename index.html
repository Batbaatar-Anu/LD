<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>{{{ PRODUCT_NAME }}}</title>
{{{ COMPRESSION_SETTINGS }}}{{{ UNITY_WEBGL_LOADER_SCRIPT }}}
<style>
  html,body{margin:0;height:100%;background:#000}
  #unity-canvas{width:100vw;height:100vh;display:block}
  #overlay{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none;display:none;z-index:4}
  #gate{position:fixed;inset:0;display:grid;place-items:center;background:#000;color:#fff;z-index:5}
  button{padding:14px 22px;border-radius:12px;border:0;font-size:16px}
</style>
</head><body>
  <canvas id="unity-canvas" tabindex="-1"></canvas>
  <video id="overlay" playsinline muted loop></video>
  <div id="gate"><button id="startBtn">Start</button></div>

<script>
  // --- Video source ---
  const v = document.getElementById('overlay');
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

  // ТАНЫ URL
  const MOV_URL  = "https://archive.org/download/intro1_202508/intro1.mov";
  const WEBM_URL = null; // Хэрэв webm+alpha нэмбэл энд тавина

  v.src = (!isSafari && WEBM_URL) ? WEBM_URL : MOV_URL;
  v.onerror = () => console.error('Video error', v.error);

  // Unity instance
  let unityInstance = null;

  // START товчны binding-ийг эхлээд хийе
  document.getElementById('startBtn').addEventListener('click', async () => {
    document.getElementById('gate').style.display = 'none';
    try { v.style.display='block'; v.currentTime=0; await v.play(); } catch(e){ console.warn(e); }
    if (unityInstance) unityInstance.SendMessage('ARManager','StartAR');
  }, { once:true });

  // Unity-г ачаална (template placeholders-ийг Unity өөрөө бөглөөнө)
  createUnityInstance(document.querySelector("#unity-canvas"), {
    dataUrl:"{{{ DATA_URL }}}", frameworkUrl:"{{{ FRAMEWORK_URL }}}", codeUrl:"{{{ CODE_URL }}}",
    memoryUrl:"{{{ MEMORY_URL }}}", symbolsUrl:"{{{ SYMBOLS_URL }}}",
    companyName:"{{{ COMPANY_NAME }}}", productName:"{{{ PRODUCT_NAME }}}", productVersion:"{{{ PRODUCT_VERSION }}}"
  }).then(u => { unityInstance = u; }).catch(err => console.error(err));

  // C#-аас дуудах гүүр (overlay.jslib)
  window.Overlay = {
    show: s => v.style.display = s ? 'block' : 'none',
    play: () => { try { v.currentTime = 0; v.play(); } catch(e){} },
    pause: () => v.pause()
  };
</script>
</body></html>
